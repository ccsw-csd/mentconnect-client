<p-toast key="questionnaireNew" position="top-center"></p-toast>
<p-blockUI [blocked]="isloading"></p-blockUI>
<div class=" grid justify-content-center align-items-center overflow-auto">

    <div class="col-12">
        <div *ngIf="isloading" class="loadWrapper flex align-items-center flex-column justify-content-center"
            style="height: calc(28.1vh);">
            <p-progressSpinner></p-progressSpinner>
        </div>

    </div>
</div>
<form id="formCreateQuestionnaire" name="newQuestionnaire" #questionnaireObj="ngForm" (ngSubmit)="saveQuestionnaire(questionnaireObj)">
<div style="height: calc(5vh - 1rem)">
    <label for="{{ 'patientEvaluation.questionnaires' | translate}}" class="ml-1 font-bold">Información general:</label>
</div><br />

<div class="card">
    <div class="formgrid grid">
        <div class="field col-12 md:col-3">
            <input id="city" name="description" type="text" placeholder="Descripción" [(ngModel)]="questionnaireObj.description" class="text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full">
        </div>
        <div class="field col-12 md:col-3">
            <input id="city" type="text" placeholder="Usuario" disabled class="text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full">
        </div>
        <div class="field col-12 md:col-3">
            <input  type="text" placeholder="Fecha creación" disabled  class="text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full">
        </div>
        <div class="field col-12 md:col-3">
            <input id="text" type="text" placeholder="Última edición" disabled class="text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full">
        </div>
    </div>
</div><br />

<div style="height: calc(8vh - 1rem)">
    <label for="{{ 'patientEvaluation.questionnaires' | translate}}" class="ml-1 font-bold">Preguntas al cuestionario:</label>
</div>
<div class="grid justify-content-center align-items-center">
    <div class="col-12 md:col-5 lg:col-5">
        <div *ngIf="isloading" class="loadWrapper flex align-items-center flex-column justify-content-center">
            <p-progressSpinner></p-progressSpinner>
        </div>
        <p-listbox [(ngModel)]="questionSelected"  name="filteredQuestions" (onChange)="disabled()" 
            [options]="filteredQuestions" [metaKeySelection]="false" [checkbox]="true" [multiple]="false"
            [showToggleAll]="false" optionLabel="filteredQuestions" styleClass="w-full"
            [listStyle]="{'height': 'calc(55vh - 1rem)','font-size':'11px'}">
            <p-header>{{ "patientEvaluation.questionnaireAvailable" | translate }}</p-header>
            <ng-template let-filteredQuestions pTemplate="item">
                <div class="filteredQuestions-item">
                    <div>
                        <span class="text-base">{{filteredQuestions.question | translate}}</span>
                        <div>
                            {{filteredQuestions.answerType.description | translate}}
                        </div>
                    </div>
                </div>
            </ng-template>
        </p-listbox> 
    </div>
    <div class="col-12 md:col-2 lg:col-2">
        <div class="field col"><br /><br />
            <button pButton type="button" (click)="toSelect(questionSelected)" icon="pi pi-angle-double-right"
                class="p-button-lg p-button-text w-full " [disabled]="questionDisabled"></button>
                <button pButton type="button" icon="pi pi-angle-double-left"
                class="p-button-lg p-button-text w-full " disabled></button>
        </div>
    </div>
    <div class="col-12 md:col-5 lg:col-5">
        <div *ngIf="isloading" class="loadWrapper flex align-items-center flex-column justify-content-center"
            style="height: calc(28.3vh);">
            <p-progressSpinner></p-progressSpinner>
        </div>
        <p-listbox readonly [options]="questionnairesQuestion" [metaKeySelection]="false" styleClass="w-full"
            *ngIf="!isloading" [showToggleAll]="false" optionLabel="questionnairesSelected"
            [listStyle]="{'height': 'calc(55vh - 1rem)','font-size':'11px'}">
            <p-header>Seleccionadas</p-header>
            <ng-template let-questionnairesQuestion pTemplate="item">
                <div class="questionnairesQuestion-item">
                    <div class="questionnairesQuestion-item">
                        <div>
                            <span class="text-base">{{questionnairesQuestion.question.question | translate}}</span>
                            <div>
                                Tipo: {{questionnairesQuestion.question.answerType.description | translate}}
                            </div>
                            <div>
                                Días:  
                                <ng-container *ngFor="let day of questionnairesQuestion.weekDays; let isLast = last">
                                    <span>{{ day.code | translate }}</span>
                                    <ng-container *ngIf="!isLast">, </ng-container>
                                  </ng-container>
                                  
                            </div>
                            <div>
                                Franja horaria: {{questionnairesQuestion.timeslot}}
                            </div>
                        </div>
                    </div>
                </div>
            </ng-template>

        </p-listbox>
    </div>
</div> 

<div style="height: calc(5vh - 1rem)" class="flex flex-row-reverse mt-2 ml-8  ">
    <div>
        <button type="button" pButton mat-raised-button (click)="onCancel($event)" class="w-7rem p-button-secondary"
            label="{{ 'patientEdit.form.close' | translate}}"></button>
        <button type="submit" class="p-button-primary w-7rem ml-2" pButton 
            label="{{ 'patientEvaluation.dialogAsignation.save' | translate}}"></button>
    </div>
</div>
</form>